<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookChat - System Status & Verification</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <noscript>
        <link rel="stylesheet" href="/static/css/noscript.css">
    </noscript>
    <script src="/static/js/theme.js"></script>
    <script>
        // Mark page as JavaScript-enabled
        document.documentElement.className = 'js';
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>System Status & Verification</h1>
            <div class="nav-links">
                <a href="/" class="nav-link">‚Üê Back to Chat</a>
                <a href="https://github.com/{{ repo_name }}" target="_blank" class="nav-link">GitHub Repository</a>
                <button class="theme-toggle js-only" id="theme-toggle">
                    <span id="theme-toggle-text">üåô</span>
                </button>
            </div>
        </div>
        
        <div class="verification-section">
            <h2>Current System Status</h2>
            <p>
                <span class="status-indicator {{ 'status-good' if git_status else 'status-error' }}"></span>
                Git Repository Status: {{ "Healthy" if git_status else "Error" }}
            </p>
            <p>
                <span class="status-indicator {{ 'status-good' if signature_status else 'status-error' }}"></span>
                Signature System: {{ "Operational" if signature_status else "Error" }}
            </p>
            <p>Current System Time: <span class="timestamp">{{ current_time }}</span></p>
            <p>Latest Commit: <a href="https://github.com/{{ repo_name }}/commit/{{ latest_commit }}" target="_blank" class="github-link"><code>{{ latest_commit[:8] }}</code></a></p>
        </div>

        <div class="verification-section">
            <h2>Independent Verification Instructions</h2>
            <p>To verify message integrity without relying on BookChat's code, follow these steps:</p>
            
            <h3>1. Message Structure</h3>
            <p>Messages are stored in the <code>messages/</code> directory with the following components:</p>
            <ul>
                <li>Message content</li>
                <li>Git commit hash</li>
                <li>Timestamp</li>
                <li>OpenSSL-based digital signature</li>
                <li>Author information</li>
                <li>Parent message ID (for threaded conversations)</li>
            </ul>

            <h3>2. Command-line Verification</h3>
            <div class="code-block">
# 1. Extract signature and message content
grep -v "SIGNATURE:" message_file.txt > message_content.txt
grep "SIGNATURE:" message_file.txt | cut -d' ' -f2 > signature.hex

# 2. Convert hex signature to binary
xxd -r -p signature.hex > signature.bin

# 3. Verify using author's public key
openssl dgst -sha256 -verify author_public_key.pub -signature signature.bin message_content.txt</div>

            <h3>3. Git History Verification</h3>
            <div class="code-block">
# Verify file hasn't been modified
git log --follow --patch message_file.txt

# Get current commit hash
git rev-parse HEAD

# Verify remote integrity
git remote -v
git fetch origin
git verify-commit origin/main</div>

            <h3>4. Timestamp Verification</h3>
            <div class="code-block">
# Compare message timestamp with git commit
git log --format=%ai -- message_file.txt | head -n1

# Verify against known timestamp
git log --since="{{ current_time }}" --format=%H message_file.txt</div>
        </div>

        <div class="verification-section">
            <h2>Public Keys</h2>
            <p>Download trusted public keys for verification:</p>
            {% for key in public_keys %}
            <div>
                <a href="/public_key/{{ key }}" class="download-link" download>Download {{ key }}</a>
                <a href="https://github.com/{{ repo_name }}/blob/main/identity/public_keys/{{ key }}" target="_blank" class="github-link">View on GitHub</a>
            </div>
            {% endfor %}
        </div>

        <div class="verification-section">
            <h2>Security Recommendations</h2>
            <ul>
                <li>Maintain your own copies of trusted public keys</li>
                <li>Verify GitHub commit signatures</li>
                <li>Cross-reference timestamps with multiple sources</li>
                <li>Use hardware security modules for key storage</li>
                <li>Monitor git remote for unexpected changes</li>
            </ul>
            <p>
                <a href="https://github.com/{{ repo_name }}/security" target="_blank" class="github-link">View Security Policy on GitHub</a>
            </p>
        </div>
    </div>
</body>
</html>
